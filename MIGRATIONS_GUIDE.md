# Database Migrations with Alembic

This project uses **Alembic** for automatic database schema migrations. You no longer need to manually delete tables and restart the server when you modify models!

## How to Use

### 1. Modify Your Model
Edit your model in `app/models/` (e.g., `app/models/user.py`)

Example: Adding a new field to the User model
```python
class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(255), unique=True, index=True, nullable=False)
    email = Column(String(255), unique=True, index=True, nullable=False)
    hashed_password = Column(String(255), nullable=False)
    is_active = Column(Boolean, default=True, nullable=False)
    # NEW FIELD:
    bio = Column(String(500), nullable=True)  # Add this line
```

### 2. Generate Migration
Run this command to automatically generate a migration file:
```bash
alembic revision --autogenerate -m "Add bio field to user"
```

This creates a new file in `migrations/versions/` with the changes detected from your models.

### 3. Review the Migration (Optional)
Open the generated migration file and review the changes before applying:
```bash
cat migrations/versions/[generated_file_name].py
```

### 4. Apply Migration
Run this command to update your database:
```bash
alembic upgrade head
```

Done! Your database schema is now updated automatically.

---

## Common Commands

### View Migration History
```bash
alembic current
```

### Downgrade to Previous Version
```bash
alembic downgrade -1
```

### Downgrade Multiple Versions
```bash
alembic downgrade -2  # Go back 2 versions
```

### Downgrade to Specific Version
```bash
alembic downgrade [revision_id]
```

---

## Tips

- **Always review autogenerated migrations** before applying them
- **Test migrations on a development database first**
- Give your migrations clear, descriptive names (e.g., `Add_email_verification_to_user`)
- If migration fails, check your model syntax for errors

---

## When to Create New Migrations

✅ **Create a migration when:**
- Adding a new field to a model
- Removing a field from a model
- Changing field constraints (unique, nullable, etc.)
- Adding or removing relationships
- Creating new models
- Renaming fields

❌ **DON'T need migrations for:**
- Just changing Python code logic
- Modifying comments in your code
